USE [plataformaMotVer6]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

--EXEC spConsultActivityByDate @FechaInicio = '2023-10-01', @FechaFinalizacion = '2023-12-15'

--Procedimiento almacenado que permite consultar registros de la tabla tblActividades por Fechas
ALTER PROCEDURE [dbo].[spConsultActivityByDate]
	@FechaInicio date,
	@FechaFinalizacion date
AS
SET NOCOUNT OFF;
BEGIN
    SELECT 
		act.idActividad, 
		act.nombreActividad, 
		act.categoria,
		act.horasAsignadas,
		act.descripcion,
		act.fechaInicio,
		act.fechaFinalizacion, 
		CONCAT(us.nombres,' ',us.apellidos) AS 'responsable',
		bie.cargo
	FROM tblActividades act
		INNER JOIN tblBienestar bie 
			ON bie.tipoDocumentoBienestar = act.tipoDocumentoBienestar AND
			   bie.numeroDocumentoBienestar = act.numeroDocumentoBienestar
		INNER JOIN tblUsuarios us 
			ON us.tipoDocumento = bie.tipoDocumentoBienestar AND 
			   us.numeroDocumento = bie.numeroDocumentoBienestar	
	WHERE (fechaInicio BETWEEN @FechaInicio AND @FechaFinalizacion) OR 
		(fechaFinalizacion BETWEEN @FechaInicio AND @FechaFinalizacion) OR 
		((fechaInicio<=@FechaInicio) AND (fechaFinalizacion>=@FechaFinalizacion))
	ORDER BY idActividad DESC;
END;
