USE [plataformaMotVer6]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

--Inicialmente se inserta un Usuario de Bienestar en la tabla tblUsuarios
--DECLARE @Registrado bit, @Mensaje varchar(20)
--EXEC spInsertarUsuario @TipoDocumento='CE', @NumeroDocumento='20016062', @Nombres='In√©s', @Apellidos='Martinez', @Correo='ines.martinez@soy.sena.edu.co', @Clave='Ines123', @Rol='Aprendiz', @Registrado=@Registrado output, @Mensaje=@Mensaje Output;
--SELECT @Registrado, @Mensaje;

--Luego si se procede a insertar el usuario-Aprendiz en el spInsertApprentice
--EXEC spInsertApprentice @TipoDocumentoAprendiz='CE', @NumeroDocumentoAprendiz='20016062', @CopiaFichaNumero='2617531';

---Procedimiento almacenado que permite insertar un registro en la tblAprendices con totalHorasAsistidas null
CREATE PROCEDURE spInsertApprentice
	@TipoDocumento varchar(10),
	@NumeroDocumento varchar(20),
	@Nombres varchar(80),
	@Apellidos varchar(80),
	@Correo varchar(100),
	@Clave varchar(150),
	@CopiaFichaNumero varchar (20),
	@Registrado BIT OUTPUT,
	@Mensaje varchar(20) output
AS
BEGIN
	SET NOCOUNT OFF;
	IF(NOT EXISTS(SELECT * FROM tblUsuarios WHERE tipoDocumento=@TipoDocumento AND numeroDocumento=@NumeroDocumento))
	BEGIN
		INSERT INTO tblUsuarios(tipoDocumento, numeroDocumento, nombres, apellidos, correo, clave, rol)
		VALUES(@TipoDocumento, @NumeroDocumento, @Nombres, @Apellidos, @Correo, @Clave, 'Aprendiz')
		INSERT INTO tblAprendices(tipoDocumentoAprendiz, numeroDocumentoAprendiz, copiaFichaNumero)
		VALUES(@TipoDocumento, @NumeroDocumento, @CopiaFichaNumero)
		SET @Registrado=1
		SET @Mensaje='Usuario registrado'
	END;
	ELSE
	BEGIN
		SET @Registrado=0
		SET @Mensaje='Correo ya existe'
	END
END;